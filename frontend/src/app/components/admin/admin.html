<div class="admin-container">
  <header class="admin-header">
    <div class="header-left">
      <h1>Admin Panel</h1>
      <p>Manage users and events for Family Hub</p>
    </div>
    <div class="header-right">
      <button class="btn btn-secondary" (click)="backToDashboard()">
        Back to Dashboard
      </button>
    </div>
  </header>

  <div class="admin-content">
    <!-- Navigation Tabs -->
    <nav class="admin-nav">
      <button 
        class="nav-btn" 
        [class.active]="activeTab === 'overview'"
        (click)="setActiveTab('overview')">
        Overview
      </button>
      <button 
        class="nav-btn" 
        [class.active]="activeTab === 'users'"
        (click)="setActiveTab('users')">
        Users
      </button>
      <button 
        class="nav-btn" 
        [class.active]="activeTab === 'events'"
        (click)="setActiveTab('events')">
        Events
      </button>
      <button 
        class="nav-btn" 
        [class.active]="activeTab === 'passwords'"
        (click)="setActiveTab('passwords')">
        Password Management
      </button>
    </nav>

    <!-- Messages -->
    <div class="message success-message" *ngIf="successMessage">
      {{ successMessage }}
    </div>
    <div class="message error-message" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <!-- Overview Tab -->
    <div class="tab-content" *ngIf="activeTab === 'overview'">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">{{ stats.totalUsers }}</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ stats.adminUsers }}</div>
          <div class="stat-label">Admin Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ stats.totalEvents }}</div>
          <div class="stat-label">Total Events</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ stats.activeEvents }}</div>
          <div class="stat-label">Active Events</div>
        </div>
      </div>

      <div class="recent-activity">
        <h3>Recent Events</h3>
        <div class="activity-list">
          <div class="activity-item" *ngFor="let event of events.slice(0, 5)">
            <div class="activity-info">
              <div class="activity-title">{{ event.title }}</div>
              <div class="activity-date">{{ formatDate(event.startTime) }}</div>
            </div>
            <div class="activity-type">{{ formatEventType(event.eventType) }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Tab -->
    <div class="tab-content" *ngIf="activeTab === 'users'">
      <div class="section-header">
        <h2>User Management</h2>
        <button class="btn btn-primary" (click)="toggleCreateUserForm()">
          {{ showCreateUserForm ? 'Cancel' : 'Create User' }}
        </button>
      </div>

      <!-- Create User Form -->
      <div class="create-form" *ngIf="showCreateUserForm">
        <h3>Create New User</h3>
        <form (ngSubmit)="createUser()" class="user-form">
          <div class="form-row">
            <div class="form-group">
              <label for="username">Username</label>
              <input
                type="text"
                id="username"
                [(ngModel)]="newUserRequest.username"
                name="username"
                class="form-control"
                required>
            </div>
            <div class="form-group">
              <label for="name">Full Name</label>
              <input
                type="text"
                id="name"
                [(ngModel)]="newUserRequest.name"
                name="name"
                class="form-control"
                required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="password">Password</label>
              <input
                type="password"
                id="password"
                [(ngModel)]="newUserRequest.password"
                name="password"
                class="form-control"
                required>
            </div>
            <div class="form-group">
              <label for="role">Role</label>
              <select
                id="role"
                [(ngModel)]="newUserRequest.role"
                name="role"
                class="form-control">
                <option *ngFor="let role of getUserRoles()" [value]="role">
                  {{ formatEventType(role) }}
                </option>
              </select>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="toggleCreateUserForm()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="isLoading">
              Create User
            </button>
          </div>
        </form>
      </div>

      <!-- Users List -->
      <div class="users-list">
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Username</th>
                <th>Role</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of users">
                <td>{{ user.name }}</td>
                <td>{{ user.username }}</td>
                <td>
                  <span class="role-badge" [class]="user.role.toLowerCase()">
                    {{ formatEventType(user.role) }}
                  </span>
                </td>
                <td>
                  <span class="status-badge" [class]="user.active ? 'active' : 'inactive'">
                    {{ user.active ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td>{{ formatDate(user.createdAt || '') }}</td>
                <td>
                  <div class="action-buttons">
                    <button 
                      class="btn btn-sm btn-outline"
                      (click)="toggleUserStatus(user)">
                      {{ user.active ? 'Deactivate' : 'Activate' }}
                    </button>
                    <button 
                      class="btn btn-sm btn-danger"
                      (click)="deleteUser(user)"
                      [disabled]="user.id === currentUser?.id">
                      Delete
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Events Tab -->
    <div class="tab-content" *ngIf="activeTab === 'events'">
      <div class="section-header">
        <h2>Event Management</h2>
      </div>

      <div class="events-list">
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Title</th>
                <th>Type</th>
                <th>Date</th>
                <th>Status</th>
                <th>Location</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let event of events">
                <td>{{ event.title }}</td>
                <td>
                  <span class="type-badge">
                    {{ formatEventType(event.eventType) }}
                  </span>
                </td>
                <td>{{ formatDate(event.startTime) }}</td>
                <td>
                  <span class="status-badge" [class]="event.status.toLowerCase()">
                    {{ formatEventType(event.status) }}
                  </span>
                </td>
                <td>{{ event.location || 'N/A' }}</td>
                <td>
                  <div class="action-buttons">
                    <button 
                      class="btn btn-sm btn-danger"
                      (click)="deleteEvent(event)">
                      Delete
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Password Management Tab -->
    <div class="tab-content" *ngIf="activeTab === 'passwords'">
      <div class="section-header">
        <h2>Password Management</h2>
        <p class="section-description">Change passwords for any user as administrator</p>
      </div>

      <!-- Password Change Form -->
      <div class="password-section">
        <h3>Change User Password</h3>
        
        <div class="success-message" *ngIf="passwordSuccessMessage">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20,6 9,17 4,12"></polyline>
          </svg>
          {{ passwordSuccessMessage }}
        </div>

        <div class="error-message" *ngIf="passwordErrorMessage">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          {{ passwordErrorMessage }}
        </div>

        <form (ngSubmit)="changeUserPassword()" class="admin-password-form">
          <div class="form-row">
            <div class="form-group">
              <label for="selectedUser">Select User</label>
              <select
                id="selectedUser"
                [(ngModel)]="passwordChangeData.selectedUserId"
                name="selectedUser"
                class="form-control"
                required>
                <option value="">Choose a user...</option>
                <option *ngFor="let user of users" [value]="user.id">
                  {{ user.name }} ({{ user.username }})
                </option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="adminCurrentPassword">Your Admin Password</label>
              <div class="password-input-container">
                <input 
                  [type]="showAdminPassword ? 'text' : 'password'"
                  id="adminCurrentPassword" 
                  name="adminCurrentPassword"
                  [(ngModel)]="passwordChangeData.adminPassword"
                  required 
                  class="form-control"
                  placeholder="Enter your admin password for verification"
                  [disabled]="isChangingPassword"
                  autocomplete="current-password">
                <button 
                  type="button" 
                  class="password-toggle-btn"
                  (mousedown)="showAdminPasswordTemporarily()"
                  (mouseup)="hideAdminPassword()"
                  (mouseleave)="hideAdminPassword()"
                  (touchstart)="showAdminPasswordTemporarily()"
                  (touchend)="hideAdminPassword()"
                  [disabled]="isChangingPassword"
                  title="Hold to show password">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="!showAdminPassword">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="showAdminPassword">
                    <path d="m1 12 4.95-4.95a10 10 0 0 1 14.1 0L24 12"></path>
                    <path d="m24 12-4.95 4.95a10 10 0 0 1-14.1 0L1 12"></path>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="userNewPassword">New Password for User</label>
              <div class="password-input-container">
                <input 
                  [type]="showUserNewPassword ? 'text' : 'password'"
                  id="userNewPassword" 
                  name="userNewPassword"
                  [(ngModel)]="passwordChangeData.newPassword"
                  required 
                  class="form-control"
                  placeholder="Enter new password for selected user"
                  [disabled]="isChangingPassword"
                  minlength="6"
                  autocomplete="new-password">
                <button 
                  type="button" 
                  class="password-toggle-btn"
                  (mousedown)="showUserNewPasswordTemporarily()"
                  (mouseup)="hideUserNewPassword()"
                  (mouseleave)="hideUserNewPassword()"
                  (touchstart)="showUserNewPasswordTemporarily()"
                  (touchend)="hideUserNewPassword()"
                  [disabled]="isChangingPassword"
                  title="Hold to show password">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="!showUserNewPassword">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="showUserNewPassword">
                    <path d="m1 12 4.95-4.95a10 10 0 0 1 14.1 0L24 12"></path>
                    <path d="m24 12-4.95 4.95a10 10 0 0 1-14.1 0L1 12"></path>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                  </svg>
                </button>
              </div>
              <div class="form-hint">Password must be at least 6 characters long</div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="confirmUserPassword">Confirm New Password</label>
              <div class="password-input-container">
                <input 
                  [type]="showConfirmUserPassword ? 'text' : 'password'"
                  id="confirmUserPassword" 
                  name="confirmUserPassword"
                  [(ngModel)]="passwordChangeData.confirmPassword"
                  required 
                  class="form-control"
                  placeholder="Confirm new password"
                  [disabled]="isChangingPassword"
                  autocomplete="new-password">
                <button 
                  type="button" 
                  class="password-toggle-btn"
                  (mousedown)="showConfirmUserPasswordTemporarily()"
                  (mouseup)="hideConfirmUserPassword()"
                  (mouseleave)="hideConfirmUserPassword()"
                  (touchstart)="showConfirmUserPasswordTemporarily()"
                  (touchend)="hideConfirmUserPassword()"
                  [disabled]="isChangingPassword"
                  title="Hold to show password">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="!showConfirmUserPassword">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="showConfirmUserPassword">
                    <path d="m1 12 4.95-4.95a10 10 0 0 1 14.1 0L24 12"></path>
                    <path d="m24 12-4.95 4.95a10 10 0 0 1-14.1 0L1 12"></path>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button 
              type="submit" 
              class="btn btn-primary"
              [disabled]="isChangingPassword || !passwordChangeData.selectedUserId || !passwordChangeData.adminPassword || !passwordChangeData.newPassword || !passwordChangeData.confirmPassword">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="isChangingPassword">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
              </svg>
              <span *ngIf="isChangingPassword">Changing Password...</span>
              <span *ngIf="!isChangingPassword">Change Password</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="loading-spinner" *ngIf="isLoading">
    <div class="spinner"></div>
  </div>
</div>